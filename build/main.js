!function(){"use strict";var e={d:function(t,i){for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{follow_my_path:function(){return o},metronome:function(){return s},tuner:function(){return n},whats_the_beat:function(){return i}});class i{start(e,t=!1){e.audio.setAudioParams(e),t||e.beat.count(e)}random(e){e.tempo.node.valueAsNumber=Math.floor(180*Math.random())+40,e.tempo.node.dispatchEvent(new Event("input",{bubbles:!0}))}}class s{start(e,t=!1){let i=e.audio.isPlaying;e.audio.setAudioParams(e),!t&&i?e.audio.stop():i||t||e.audio.start()}random(e){e.tempo.node.valueAsNumber=Math.floor(180*Math.random())+40,e.tempo.node.dispatchEvent(new Event("input",{bubbles:!0}))}}class n{start(e,t=!1){let i=e.audio.setAudioParams(e);e.audio.tempo=0,!t&&i?e.audio.stop():(!t||t&&i)&&e.audio.start()}random(e){let t=Math.floor(11*Math.random());e.note.node.value=e.note.node.children[t].value,e.note.node.dispatchEvent(new Event("input",{bubbles:!0}))}}class o{async start(e,t=!1){let i=e.audio.setAudioParams(e);void 0===this.repeat&&(this.repeat=!1),void 0===this.count?this.count=e.repeat.current:this.count!==e.repeat.current&&(this.repeat=!1,this.count=e.repeat.current),t||(i?e.audio.stop():(await e.audio.repeatXTimes(e,parseInt(e.repeat.current),this.repeat),this.repeat=!0,document.getElementById("start").dispatchEvent(new Event("input",{bubbles:!0}))))}random(e){this.repeat=!1}}class r{constructor(e,t=100){this.default=e,this.current=e,this.node=null,this.intervalTime=t,this.target=null}getTempoToSecond(e){return 60/e}init(e,t=null){this.node=e,0!==this.current&&(e.value=this.current,this.setVisibleValue(e)),this.target=t}modifyValue(e,t){return e.valueAsNumber+=t,e.valueAsNumber}updateInput(e,t){let i=0;switch(e.target.textContent){case"+":i=1;break;case"-":i=-1}return this.current=this.modifyValue(t,i),this.setVisibleValue(t),i&&"input"!==e.type?window.setInterval((function(e,t,i){e.current=e.modifyValue(t,i),e.setVisibleValue(t)}),this.intervalTime,this,t,i):null}reset(){this.node&&(this.node.valueAsNumber=this.default,this.current=this.default,this.setVisibleValue(this.node))}setVisibleValue(e){e.parentNode.parentNode.firstElementChild.querySelectorAll("span")[1].innerText=e.value}}class a extends r{constructor(e){super(e),this.currentValueAsNumber=0}modifyValue(e,t){let i=0,s=null;for(;s=e.children[i];){if(e.value===s.value){let s=(i+t)%e.children.length;if(s<0){if(s+=e.children.length,this.target){let e=new Event("input",{bubbles:!0});this.target.minus.dispatchEvent(e)}}else if((i+t)/e.children.length>=1&&this.target){let e=new Event("input",{bubbles:!0});this.target.plus.dispatchEvent(e)}this.currentValueAsNumber=s,e.value=e.children[s].value;break}i++}return e.value}reset(){this.node&&(this.node.value=this.default,this.current=this.default,this.modifyValue(this.node,0),this.setVisibleValue(this.node))}}const h={main:document.querySelector("main"),nav:document.querySelector("nav"),title:document.querySelector("h1")},u={index:["mode","note","gamme","waveForm","octave","pitch","tempo","repeat","beat","audio","painter"],mode:new a("chromatique"),note:new a("A"),gamme:new a("A"),waveForm:new a("sine"),octave:new r(3),pitch:new r(442,70),tempo:new r(60),repeat:new r(1),beat:new class{constructor(){this.current=0,this.reset()}reset(){this.beatCount=0,this.savedTime=[0,0,0],this.savedTick=0,this.fixedBeatCount=60*this.savedTime.length}computeBeats(e,t,i){let s;return t<this.savedTime.length?(s=60*t/e,this.savedTime[t]=e):(s=i/(e-this.savedTime[this.savedTick]),this.savedTime[this.savedTick]=e,this.savedTick+=1,this.savedTick===this.savedTime.length&&(this.savedTick=0)),console.log(this,s,e),s}count(e){e.audio.interval||this.reset(),e.audio.start(!1);let t=this.computeBeats(e.audio.audioCtx.currentTime,this.beatCount,this.fixedBeatCount);this.beatCount+=1,isNaN(t)||t===1/0||(e.tempo.node.valueAsNumber=t,e.tempo.node.dispatchEvent(new Event("input",{bubbles:!0})))}},audio:new class{constructor(){this.lastTime=0,this.interval=null,this.audioCtx=null,this.gainNode=null,this.filterNode=null,this.noise=null,this.isMuted=!1,this.waveForm=null,this.frequency=0,this.tempo=0,this.saved={frequency:[]},this.pitches=this.setPitchesConstantes(),this.isPlaying=!1}setAudioParams(e){return this.setFrequency(e.note.currentValueAsNumber,e.pitch.current,e.octave.current),this.setTempo(e.tempo.current),this.setWaveForm(e.waveForm.current),this.isPlaying}reset(){this.stop(),this.isMuted=!1,this.waveForm=null,this.frequency=0,this.saved={frequency:[]}}mute(){this.gainNode&&(0===this.gainNode.gain.value?this.gainNode.gain.linearRampToValueAtTime(1,this.audioCtx.currentTime):this.gainNode.gain.linearRampToValueAtTime(0,this.audioCtx.currentTime)),this.isMuted=!this.isMuted}setPitchesConstantes(){let e=Math.pow(2,1/12),t=0,i=[];for(;t<12;)i[t]=Math.pow(e,t),++t;return i}setFrequency(e,t,i){this.frequency=t*this.pitches[e]/Math.pow(2,3-i)}setWaveForm(e){this.waveForm=e}setTempo(e){this.tempo=e}stop(){this.interval&&(window.clearInterval(this.interval),this.interval=null),this.lastTime=0,this.noise&&this.noise.disconnect(),this.gainNode&&this.gainNode.disconnect(),this.filterNode&&this.filterNode.disconnect(),this.noise=null,this.gainNode=null,this.filterNode=null,this.isPlaying=!1,this.nodeToDisconnect&&(this.nodeToDisconnect.disconnect(),this.nodeToDisconnect=null),this.audioCtx=null}setNoiseNode(e){let t=this.setGainNode(this.audioCtx,this.gainNode,this.isMuted);if(!e){let i=this.setFilter(this.audioCtx,this.filterNode);return(e=new OscillatorNode(this.audioCtx,{frequency:this.frequency,type:this.waveForm})).connect(i).connect(t).connect(this.audioCtx.destination),this.noise=e,!0}return e.frequency.value=this.frequency,e.type=this.waveForm,!1}setGainNode(e,t,i){return t||(t=e.createGain(),this.gainNode=t),t.gain.value=i?0:1,t}setFilter(e,t){return t||((t=e.createBiquadFilter("bandpass")).Q.value=.1,this.filterNode=t),this.filterNode}start(e=!0){this.audioCtx||(this.audioCtx=new(window.AudioContext||window.webkitAudioContext)),e?0===this.tempo?this.play():this.toggle(this.interval):(this.interval&&window.clearTimeout(this.interval),this.interval=setTimeout((function(e){e.reset()}),2500,this))}toggle(e){e?this.stop():(this.isPlaying=!0,this.setNoiseNode(),this.interval=setInterval((function(e){let t=60/e.tempo;e.lastTime+t/2<=e.audioCtx.currentTime&&e.repeat(e.lastTime+t,.09)}),125,this))}repeat(e,t){console.log("time: ",e),this.lastTime=e,this.noise.start(e),this.noise.stop(e+t),this.nodeToDisconnect&&(this.nodeToDisconnect.disconnect(),this.nodeToDisconnect=null),this.nodeToDisconnect=this.noise,this.setNoiseNode(null)}play(){this.setNoiseNode(this.noise),this.isPlaying||(this.lastTime=this.audioCtx.currentTime,this.noise.start(),this.isPlaying=!0)}async repeatXTimes(e,t,i){this.stop();let s=60/this.tempo;console.log(this.saved,t,i);let n=2*s,o=3*s;this.isPlaying=!0,this.audioCtx||(this.audioCtx=new(window.AudioContext||window.webkitAudioContext)),this.setCurrentNoteForRepetition(e,0,i),this.setNoiseNode();let r=0;for(;r<t;)r!==t-1&&this.setCurrentNoteForRepetition(e,r+1,i),this.repeat(r*o,n),this.nodeToDisconnect=null,r++;await this.sleep(t+.1*o*1e3)}setCurrentNoteForRepetition(e,t,i){console.log("index to save",t),i?this.frequency=this.saved.frequency[t]:(this.randomNote(e),this.saved.frequency.push(this.frequency))}async sleep(e){return new Promise((t=>setTimeout(t,e)))}randomNote(e){this.setFrequency(Math.floor(11*Math.random()),e.pitch.current,e.octave.current)}},painter:new class{constructor(e,t){let i=document.querySelectorAll("[route]"),s=document.createElement("A");this.pages=[],this.actions=e,this.mainTitle="Tuner",this.regex=/_/g;for(let e of i)e.hasAttribute("home")?this.pages.home=e:(this.pages[e.id]=e,"error"!==e.id&&(s.href="/"+e.id,s.innerText=e.id.replace(this.regex," "),t.appendChild(s.cloneNode(!0))))}drawNewPage(e,t){let i="",s=window.location.pathname.slice(1);s?this.pages[s]?i=s:(s="error",i="error"):s="home",this.setRobotsMeta(s),this.draw(e.main,this.pages[s].content),e.title.innerText=this.setTitle(i,this.regex);let n=this.actions[i];return void 0===n&&(n=this.actions[this.pages.home.id]),t.init(e.main),n?n.prototype:n}setTitle(e,t){return e?this.pages[e]?e.replace(t," "):"error":this.mainTitle}draw(e,t){for(let i of t.children)e.appendChild(document.importNode(i,!0))}setRobotsMeta(e){let t=document.head.querySelector("meta[name=robots]"),i=document.createElement("meta");t&&document.head.removeChild(t),i.name="robots","error"===e&&(i.content="noindex"),document.head.appendChild(i)}reset(){}}(t,h.nav.firstElementChild),init(e){let t=e.querySelectorAll("input, select");for(let e of t)this[e.name].init(e);this.octave.node&&this.note.init(this.note.node,{minus:this.octave.node.previousElementSibling,plus:this.octave.node.nextElementSibling})},reset(){for(let e of this.index)this[e].reset()},storeValues(e){if(e)for(let e of this.index)localStorage.setItem(e,this[e].current)},getStoredValues(){if(!this.storageAvailable("localStorage"))return!1;let e=null;for(let t of this.index)e=localStorage.getItem(t),e&&(this[t].current=e);return!0},storageAvailable(e){let t;try{t=window[e];let i="__storage_test__";return t.setItem(i,i),t.removeItem(i),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}};new class{constructor(e,t){this.workshops=e,this.mainNodes=t,this.firstEvent=!0,this.inputInterval=null,this.canStore=this.workshops.getStoredValues();let i=t.nav.querySelectorAll("a");for(let e of i)e.addEventListener("click",this,!0),e.addEventListener("touchstart",this,!0);t.main.addEventListener("change",this,{passive:!0}),document.addEventListener("mousedown",this,{passive:!0}),t.main.addEventListener("mouseup",this,{passive:!0}),document.addEventListener("touchstart",this,{passive:!0}),t.main.addEventListener("touchend",this,{passive:!0}),t.main.addEventListener("input",this,{passive:!0}),window.addEventListener("popstate",this,!0),this.page=e.painter.drawNewPage(t,e),this.handleEvent=function(e){this.eventDispatcher(e,this.page,this.mainNodes,this.workshops,this.inputInterval)}}eventDispatcher(e,t,i,s,n){if("touchend"!==e.type&&"mouseup"!==e.type||n){if(this.inputInterval&&"input"!==e.type)return window.clearInterval(this.inputInterval),void(this.inputInterval=null);this.firstEvent=this.removeUselessListener(this.firstEvent,e,i.main),this.newPageCase(s,i.main,e)||this.navCase(e,i.nav)||this.buttonCase(e,s,t)||this.inputCase(e,s,t)}}inputCase(e,t,i){let s=null,n=null;s="SELECT"!==e.target.nodeName||"INPUT"!==e.target.nodeName?e.target.parentNode.querySelector("select, input"):e.target,!s||"SELECT"!==s.nodeName&&"INPUT"!==s.nodeName||(n=t[s.id].updateInput(e,s),n&&(this.inputInterval=n),i.start(t,!0)),this.workshops.storeValues(this.canStore)}buttonCase(e,t,i){if(e.which&&1!==e.which)return!1;let s=e.target;if("BUTTON"!==s.nodeName){if("I"!==s.nodeName)return!1;s=e.target.parentNode}switch("mute"!==s.id&&"start"!==s.id||s.classList.toggle("gg-on"),s.id){case"start":return i.start(t),!0;case"random":return i.random(t),!0;case"reset":return t.reset(),this.resetButtons(),!0;case"mute":return t.audio.mute(),!0;case"help":return this.helpButton(),!0;case"close-help":return this.closeHelpButton(),!0;default:return!1}}resetButtons(){let e=document.getElementsByTagName("BUTTON");for(let t of e)t.classList.contains("gg-on")&&t.classList.remove("gg-on")}helpButton(){let e=document.getElementById("helper"),t=document.getElementById("help-box");e&&(t.lastElementChild.innerHTML=e.innerHTML,t.hidden=!1)}closeHelpButton(){document.getElementById("help-box").hidden=!0}navCase(e,t){if(1!==e.which)return!1;let i=e.target;return("burger"===i.parentNode.id||"burger"===i.id||"gg-modal"===i.className)&&(t.toggleAttribute("hidden"),this.closeHelpButton(),!0)}newPageCase(e,t,i){if("A"!==i.target.nodeName&&"popstate"!==i.type)return!1;if("A"===i.target.nodeName&&"mousedown"===i.type)return!0;i.preventDefault();let s="";for("popstate"===i.type?s=window.location.pathname:(s=i.target.getAttribute("href"),this.mainNodes.nav.toggleAttribute("hidden")),e.audio.reset();t.children.length;)t.removeChild(t.children[0]);return"popstate"!==i.type&&window.history.pushState({},window.title,s),this.page=e.painter.drawNewPage(this.mainNodes,e),document.title=document.getElementById("wtb-title").innerText,document.querySelector('meta[name="description"]').content=document.getElementById("wtb-description").innerText,this.workshops.storeValues(this.canStore),!0}removeUselessListener(e,t,i){return e&&("mousedown"===t.type?(document.removeEventListener("touchstart",this),i.removeEventListener("touchend",this)):(document.removeEventListener("mousedown",this),i.removeEventListener("mouseup",this))),!1}}(u,h)}();